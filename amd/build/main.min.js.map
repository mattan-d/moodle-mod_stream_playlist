{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main.\n *\n * @package\n * @category    admin\n * @copyright  2024 mattandor <mattan@centricapp.co.il>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\"jquery\", \"core/ajax\", \"core/notification\", \"core/str\", \"core/url\"], ($, ajax, notification, str, url) => ({\n  init: function () {\n    var self = this\n\n    this.elements = $(\"#stream-elements\")\n    this.loadingbars = url.imageUrl(\"icones/loading-bars\", \"stream\")\n    this.selectedIds = ($(\"#id_identifier\").val() || \"\").split(\",\").filter(Boolean)\n\n    $(\"body\").on(\"click\", \"#stream-elements .list-item-grid\", function () {\n      var itemid = $(this).data(\"itemid\").toString()\n      var index = self.selectedIds.indexOf(itemid)\n\n      if (index > -1) {\n        self.selectedIds.splice(index, 1)\n        $(this).find(\".item\").removeClass(\"selected\")\n      } else {\n        self.selectedIds.push(itemid)\n        $(this).find(\".item\").addClass(\"selected\")\n      }\n      $(\"#id_identifier\").val(self.selectedIds.join(\",\"))\n    })\n\n    $(\"body\").on(\"click\", \"#stream-load #stream-sort .btn\", function (e) {\n      e.preventDefault()\n      $(\"#stream-load #stream-sort .btn\").removeClass(\"active\")\n      $(this).toggleClass(\"active\")\n      self.load()\n    })\n\n    $(\"body\").on(\"click\", \".btn-upload\", (e) => {\n      e.preventDefault()\n      $(\"#upload_stream\").toggle()\n    })\n\n    $(\"#stream-title-search\").keyup(() => {\n      self.load()\n    })\n\n    this.load()\n\n    window.addEventListener(\n      \"message\",\n      (event) => {\n        if (event.data.iframeHeight) {\n          var iframe = document.getElementById(\"upload_stream\")\n          if (iframe) {\n            iframe.style.height = event.data.iframeHeight + \"px\"\n          }\n        }\n      },\n      false,\n    )\n\n    // Add event listener to receive messages from iframes\n    window.addEventListener(\n      \"message\",\n      function (event) {\n        this.message(event, self)\n      }.bind(this),\n      false,\n    )\n  },\n  message: (event, self) => {\n    // Check if the message contains the streamid\n    if (event.data && event.data.streamid) {\n      var streamid = event.data.streamid.toString()\n      if (self.selectedIds.indexOf(streamid) === -1) {\n        self.selectedIds.push(streamid)\n      }\n      $(\"#id_identifier\").val(self.selectedIds.join(\",\"))\n      $(\"#upload_stream\").hide()\n      self.load()\n    }\n  },\n  load: function () {\n    var sort = $(\"#stream-load #stream-sort .btn.active\").attr(\"data-name\")\n\n    this.elements.html('<div style=\"text-align:center\"><img height=\"80\" src=\"' + this.loadingbars + '\" ></div>')\n\n    ajax\n      .call([\n        {\n          methodname: \"mod_stream_video_list\",\n          args: {\n            term: $(\"#stream-title-search\").val(),\n            courseid: $('input[name=\"course\"]').val(),\n            sort: sort,\n          },\n        },\n      ])[0]\n      .then((response) => this.list(response, this))\n      .catch((error) => this.failed(error, this))\n  },\n  failed: (error, self) =>\n    str\n      .get_string(\"servererror\", \"moodle\")\n      .then((connectionfailed) => self.elements.html('<div class=\"alert alert-danger\">' + connectionfailed + \"</div>\")),\n  list: (response, self) => {\n    if (response.status == \"success\") {\n      if (response.videos.length) {\n        self.elements.html(\"\")\n\n        $.each(response.videos, (key, video) => {\n          str\n            .get_strings([\n              { key: \"views\", component: \"mod_stream\" },\n              { key: \"before\", component: \"mod_stream\" },\n            ])\n            .then((string) => {\n              var html =\n                '<div class=\"col list-item-grid\" data-itemid=\"' +\n                video.id +\n                '\" id=\"video_identifier_' +\n                video.id +\n                '\">' +\n                '<span class=\"item\"><div class=\"thumbnail\">' +\n                '<img src=\"' +\n                video.thumbnail +\n                '\" class=\"img-fluid img-rounded\">' +\n                '<span class=\"datecreated\">' +\n                video.datecreated +\n                '</span><span class=\"duration\">' +\n                video.duration +\n                '</span></div><span class=\"title\">' +\n                video.title +\n                '</span><span class=\"details\">' +\n                video.views +\n                \" \" +\n                string[0] +\n                ' <span class=\"bubble\">‚óè</span>' +\n                \" \" +\n                string[1] +\n                \" \" +\n                video.elapsed +\n                \"</span></span></div>\"\n              self.elements.append(html)\n\n              if (self.selectedIds.indexOf(video.id.toString()) > -1) {\n                $(\"#video_identifier_\" + video.id)\n                  .find(\".item\")\n                  .addClass(\"selected\")\n              }\n\n              return null\n            })\n            .catch((error) => self.failed(error, self))\n        })\n      } else {\n        return str\n          .get_string(\"noresults\", \"mod_stream\")\n          .then((noresults) => self.elements.html('<div class=\"alert alert-info\">' + noresults + \"</div>\"))\n      }\n    }\n    return true\n  },\n}))\n"],"names":["define","$","ajax","notification","str","url","init","self","this","elements","loadingbars","imageUrl","selectedIds","val","split","filter","Boolean","on","itemid","data","toString","index","indexOf","splice","find","removeClass","push","addClass","join","e","preventDefault","toggleClass","load","toggle","keyup","window","addEventListener","event","iframeHeight","iframe","document","getElementById","style","height","message","bind","streamid","hide","sort","attr","html","call","methodname","args","term","courseid","then","response","list","catch","error","failed","get_string","connectionfailed","status","videos","length","noresults","each","key","video","get_strings","component","string","id","thumbnail","datecreated","duration","title","views","elapsed","append"],"mappings":"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"}